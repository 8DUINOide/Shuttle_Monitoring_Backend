<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link rel="icon" type="image/png" href="images/logo.png">
    <link rel="stylesheet" href="styles.css?v=2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.js"></script>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.9.2/mapbox-gl.css" rel="stylesheet">
    <script
        src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v5.0.0/mapbox-gl-geocoder.css"
        type="text/css">
    <script
        src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.js"></script>
    <link rel="stylesheet"
        href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-directions/v4.1.0/mapbox-gl-directions.css"
        type="text/css">
    <style>
        .map-search {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-right: 10px;
        }

        .map-search input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            width: 200px;
        }

        .map-search button {
            padding: 8px 12px;
            background-color: #003A6C;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .map-search button:hover {
            background-color: #0066CC;
        }

        .map-container {
            position: relative;
            width: 100%;
            height: 600px;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .active-shuttles {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .map-style-selector {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 1;
            background: white;
            padding: 5px;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .map-style-selector select {
            padding: 5px;
            font-size: 14px;
        }

        /* Notification Styles */
        /* Notification Styles - Enhanced */
        .notification-item {
            background-color: #fff;
            border-left: 4px solid #ddd;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            cursor: pointer;
            border: 1px solid #eee;
            border-left-width: 4px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .notification-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .notification-item.unread {
            background-color: #f0f7ff;
            border-left-color: #2196F3;
        }

        .notification-icon {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .notification-content {
            flex-grow: 1;
        }

        .notification-body {
            font-size: 0.95rem;
            color: #333;
            margin-bottom: 4px;
            line-height: 1.4;
        }

        .notification-time {
            font-size: 0.8rem;
            color: #888;
        }

        .notification-dot {
            width: 10px;
            height: 10px;
            background-color: #2196F3;
            border-radius: 50%;
            flex-shrink: 0;
        }

        .notification-badge {
            background-color: #ff4d4f;
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 10px;
            position: absolute;
            top: 10px;
            right: 15px;
            display: none;
            /* Hidden by default */
        }
    </style>
</head>

<body>
    <div id="login-screen" class="login-bg">
        <div class="login-container">
            <img src="images/logo.png" class="logo">
            <h3
                style="color: #003A6C; font-size: 2rem; margin: 0.5rem 0 2rem 0; font-weight: bold; text-align: center;">
                Ride.ADNU</h3>
            <input type="text" placeholder="Username" id="username">
            <div class="password-wrapper">
                <input type="password" placeholder="Password" id="password">
                <span class="toggle-password" onclick="togglePassword('password', this)">
                    <i class="fa-solid fa-eye-slash"></i>
                </span>
            </div>
            <p id="login-error" class="error-text"
                style="display:none; color: red; text-align: center; margin-top: 10px;"></p>
            <button onclick="login()">Sign in</button>
            <a href="reset-password.html"
                style="display: block; margin-top: 10px; text-align: center; color: #ffffff;">Forgot Password?</a>
        </div>
    </div>

    <div id="dashboard" class="dashboard" style="display: none">
        <div id="sidebar" class="sidebar">
            <div class="sidebar-profile">
                <img id="sidebar-profile-picture" src="images/default-profile.png" alt="Admin Profile Picture"
                    class="sidebar-profile-pic">
                <p class="sidebar-username" id="sidebar-username"></p>
                <p class="sidebar-email" id="sidebar-email"></p>
            </div>
            <ul>
                <li onclick="showTab('home')"><i class="fa-solid fa-house"></i> Dashboard</li>
                <li onclick="showTab('live-map')"><i class="fa-solid fa-map-location-dot"></i> Live Map</li>
                <li onclick="showTab('students')"><i class="fa-solid fa-users"></i> Students</li>
                <li onclick="showTab('drivers')"><i class="fa-solid fa-id-card"></i> Drivers</li>
                <li onclick="showTab('shuttles')"><i class="fa-solid fa-bus"></i> Shuttles</li>
                <li onclick="showTab('registration')"><i class="fa-solid fa-id-card"></i> Registration</li>
                <li onclick="showTab('checkin')"><i class="fa-solid fa-clipboard-check"></i> Check-In</li>
                <li onclick="showTab('ride-history')"><i class="fa-solid fa-clock-rotate-left"></i> Ride History</li>

                <li onclick="showTab('notifications')" style="position: relative;">
                    <i class="fa-solid fa-bell"></i> Notifications
                    <span id="notification-badge" class="notification-badge">0</span>
                </li>
                <li onclick="showTab('messages')" style="position: relative;">
                    <i class="fa-solid fa-message"></i> Messages
                    <span id="messages-badge" class="notification-badge">0</span>
                </li>
                <li onclick="showTab('profile')"><i class="fa-solid fa-user"></i> Profile</li>
                <li onclick="showLogoutConfirmModal()"><i class="fa-solid fa-sign-out-alt"></i> Logout</li>
            </ul>
        </div>

        <div class="sidebar-toggle" onclick="toggleSidebar()">â˜°</div>
        <div id="content" class="content">
            <div id="home" class="tab active">
                <header>
                    <div class="title-container">
                        <i class="fa-solid fa-house"></i>
                        <h2>Dashboard Overview</h2>
                    </div>
                    <p>Real-time shuttle monitoring and management</p>
                </header>
                <div class="balance-section">
                    <div class="balance-card">
                        <div class="label">Active Shuttles</div>
                        <h1>0</h1>
                    </div>
                    <div class="balance-card">
                        <div class="label">Students Checked In</div>
                        <h1>0</h1>
                    </div>
                    <div class="balance-card">
                        <div class="label">On time Performance</div>
                        <h1>0%</h1>
                    </div>
                    <div class="balance-card">
                        <div class="label">Routes Active</div>
                        <h1>0</h1>
                    </div>
                    <div class="chart-card">
                        <h4>Today's Routes</h4>
                        <table id="todays-routes-table">
                            <thead>
                                <tr>
                                    <th>Route</th>
                                    <th>Shuttle</th>
                                    <th>Driver</th>
                                    <th>Capacity</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                    <div class="chart-card">
                        <h4>Recent Activity</h4>
                        <ul id="recent-activity-list"></ul>
                    </div>
                </div>
            </div>

            <div id="shuttles" class="tab">
                <header>
                    <div class="title-container">
                        <i class="fa-solid fa-bus"></i>
                        <h2>Shuttle Management</h2>
                    </div>
                    <p>Monitor and manage all shuttle operations</p>
                </header>
                <div class="table-header">
                    <div class="table-title-section">
                        <h3>Active Shuttles</h3>
                        <p>Real time shuttle tracking and status monitoring</p>
                    </div>
                    <div class="table-actions">
                        <button class="add-btn" onclick="showAddShuttleModal()">
                            <i class="fa-solid fa-plus"></i> Add Shuttle
                        </button>
                    </div>
                </div>
                <div class="search-container">
                    <input id="searchShuttles" type="text" placeholder="Search shuttles, drivers, or routes..."
                        oninput="filterShuttles()">
                    <select id="statusFilter" onchange="filterShuttles()">
                        <option value="all">All Status</option>
                        <option value="ACTIVE">Active</option>
                        <option value="INACTIVE">Inactive</option>
                        <option value="MAINTENANCE">Maintenance</option>
                    </select>
                </div>
                <p id="no-shuttles-message" style="display:none; color: red; margin-top: 10px;">No shuttles found.</p>
                <table>
                    <thead>
                        <tr>
                            <th>Shuttle</th>
                            <th>Driver</th>
                            <th>License</th>
                            <th>Route</th>
                            <th>Status</th>
                            <th>Assigned Students</th>

                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="shuttles-table"></tbody>
                </table>
            </div>

            <div id="registration" class="tab" style="position: relative;">
                <header>
                    <div class="title-container">
                        <i class="fa-solid fa-id-card"></i>
                        <h2>Registration & Assignment</h2>
                    </div>
                    <p>Assign shuttles and register devices for students</p>
                </header>
                <!-- Hardware Simulator Widget (Tab Specific) -->
                <div id="hardware-simulator"
                    style="position: absolute; top: 20px; right: 20px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 3000; border: 2px solid #003A6C;">
                    <h4 style="margin: 0 0 10px 0; color: #003A6C; font-size: 1rem;"><i
                            class="fa-solid fa-microchip"></i>
                        Hardware Simulator</h4>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <button onclick="simulateHardwareScan('rfid')"
                            style="padding: 8px; background: #003A6C; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fa-solid fa-id-card"></i> Simulate RFID Scan
                        </button>
                        <button onclick="simulateHardwareScan('fingerprint')"
                            style="padding: 8px; background: #003A6C; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fa-solid fa-fingerprint"></i> Simulate Fingerprint
                        </button>
                    </div>
                </div>
                <div class="table-header">
                    <div class="table-title-section">
                        <h3>Student Registration</h3>
                    </div>
                    <div class="table-actions">

                    </div>
                </div>
                <div class="search-container">
                    <input id="searchRegistration" type="text" placeholder="Search student, grade, or shuttle..."
                        oninput="filterRegistration()">
                    <select id="statusFilterRegistration" onchange="filterRegistration()">
                        <option value="all">All Status</option>
                        <option value="assigned">Assigned</option>
                        <option value="unassigned">Unassigned</option>
                    </select>
                </div>
                <p id="no-registration-message" style="display:none; color: red; margin-top: 10px;">No students found.
                </p>
                <table>
                    <thead>
                        <tr>
                            <th>Student</th>
                            <th>Grade/Section</th>
                            <th>Assigned Shuttle</th>
                            <th>Device Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="registration-table"></tbody>
                </table>
            </div>

            <div id="students" class="tab users-tab">
                <header>
                    <div class="title-container">
                        <i class="fa-solid fa-users"></i>
                        <h2>Student Management</h2>
                    </div>
                    <p>Manage student records and contact information</p>
                </header>
                <div class="table-header">
                    <div class="table-title-section">
                        <h3>Registered Students</h3>
                        <p>Database of all students in the shuttle system</p>
                    </div>
                    <div class="table-actions">
                        <button class="add-btn" onclick="showAddParentModal()">
                            <i class="fa-solid fa-plus"></i> Add Parent & Students
                        </button>
                        <button class="add-btn bulk-btn" onclick="showBulkUploadModal('students')">
                            <i class="fa-solid fa-file-excel"></i> Bulk Upload
                        </button>
                    </div>
                </div>
                <div class="search-container">
                    <input id="searchStudents" type="text" placeholder="Search students or parents..."
                        oninput="filterStudents()">
                </div>
                <p id="no-students-message" style="display:none; color: red; margin-top: 10px;">No students found.</p>
                <table>
                    <thead>
                        <tr>
                            <th><i class="fa-solid fa-user"></i> Student</th>
                            <th><i class="fa-solid fa-user"></i> Parent/Guardian</th>
                            <th><i class="fa-solid fa-address-book"></i> Contact</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="students-table"></tbody>
                </table>
            </div>

            <div id="checkin" class="tab users-tab" style="position: relative;">
                <header>
                    <div class="title-container">
                        <i class="fa-solid fa-clipboard-check"></i>
                        <h2>Check-In Management</h2>
                    </div>
                    <p>Real-time monitoring of student check-ins and boardings</p>
                </header>
                <!-- Check-In Hardware Simulator -->
                <div id="checkin-hardware-simulator"
                    style="position: absolute; top: 20px; right: 20px; background: white; padding: 15px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 3000; border: 2px solid #003A6C;">
                    <h4 style="margin: 0 0 10px 0; color: #003A6C; font-size: 1rem;"><i
                            class="fa-solid fa-microchip"></i> Hardware Simulator</h4>
                    <select id="sim-shuttle-select"
                        style="width: 100%; padding: 5px; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 4px;">
                        <option value="">Select Shuttle Context</option>
                    </select>
                    <div style="display: flex; flex-direction: column; gap: 8px;">
                        <button onclick="simulateCheckInScan('rfid')"
                            style="padding: 8px; background: #003A6C; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fa-solid fa-id-card"></i> Scan RFID
                        </button>
                        <button onclick="simulateCheckInScan('fingerprint')"
                            style="padding: 8px; background: #003A6C; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            <i class="fa-solid fa-fingerprint"></i> Scan Fingerprint
                        </button>
                    </div>
                </div>
                <div class="table-header">
                    <div class="table-title-section">
                        <h3>Student Check-In Status</h3>
                        <p>Live status of student locations</p>
                    </div>
                    <div class="table-actions">
                        <!-- Actions can go here if needed -->
                    </div>
                </div>
                <div class="search-container">
                    <input id="searchCheckIn" type="text" placeholder="Search students..." oninput="filterCheckIn()">
                    <select id="statusFilterCheckIn" onchange="filterCheckIn()">
                        <option value="all">All Status</option>
                        <option value="Checked In">Checked In</option>
                        <option value="Checked Out">Checked Out</option>
                        <option value="Not Boarded">Not Boarded</option>
                    </select>
                </div>
                <p id="no-checkin-message" style="display:none; color: red; margin-top: 10px;">No records found.</p>
                <table>
                    <thead>
                        <tr style="background-color: #003A6C; color: white;">
                            <th>Student</th>
                            <th>Assigned Shuttle</th>
                            <th>Status</th>
                            <th>Time & Location</th>
                        </tr>
                    </thead>
                    <tbody id="checkin-table"></tbody>
                </table>
            </div>

            <div id="ride-history" class="tab users-tab">
                <header>
                    <div class="title-container">
                        <i class="fa-solid fa-clock-rotate-left"></i>
                        <h2>Shuttle Ride History</h2>
                    </div>
                    <p>View historical records of completed shuttle rides</p>
                </header>

                <div class="table-header">
                    <div class="table-title-section">
                        <h3>History Log</h3>
                        <p>Detailed list of all previous shuttle operations</p>
                    </div>
                    <div class="table-actions">
                        <button class="add-btn" onclick="loadRideHistory()">
                            <i class="fa-solid fa-arrows-rotate"></i> Refresh
                        </button>
                    </div>
                </div>

                <div class="search-container">
                    <input id="searchRideHistory" type="text" placeholder="Search shuttle or driver..."
                        oninput="filterRideHistory()">
                </div>

                <table>
                    <thead>
                        <tr>
                            <th><i class="fa-solid fa-hashtag"></i> ID</th>
                            <th><i class="fa-solid fa-bus"></i> Shuttle</th>
                            <th><i class="fa-solid fa-user-tie"></i> Driver</th>
                            <th><i class="fa-solid fa-route"></i> Route</th>
                            <th><i class="fa-solid fa-clock"></i> Start</th>
                            <th><i class="fa-solid fa-flag-checkered"></i> End</th>
                        </tr>
                    </thead>
                    <tbody id="ride-history-table"></tbody>
                </table>
            </div>

            <div id="messages" class="tab">
                <header>
                    <div class="title-container">
                        <i class="fa-solid fa-message"></i>
                        <h2>Messages</h2>
                    </div>
                    <p>Communicate with allowed contacts</p>
                </header>
                <div class="messaging-container">
                    <div class="contacts-sidebar">
                        <div class="contacts-header">
                            <h3>Contacts</h3>
                        </div>
                        <div id="contacts-list" class="contacts-list">
                            <!-- Contacts will be loaded here -->
                        </div>
                    </div>
                    <div class="chat-area">
                        <div id="chat-header" class="chat-header">
                            <h3 id="chat-with-name">Select a contact to start messaging</h3>
                        </div>
                        <div id="chat-history" class="chat-history">
                            <!-- Chat messages will be loaded here -->
                        </div>
                        <div class="chat-input-area">
                            <input type="text" id="message-input" placeholder="Type a message..."
                                onkeypress="handleMessageKeyPress(event)">
                            <button onclick="sendChatMessage()"><i class="fa-solid fa-paper-plane"></i></button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="drivers" class="tab users-tab">
                <header>
                    <div class="title-container">
                        <i class="fa-solid fa-id-card"></i>
                        <h2>Driver Management</h2>
                    </div>
                    <p>Monitor and manage all driver operations</p>
                </header>
                <div class="table-header">
                    <div class="table-title-section">
                        <h3>Active Drivers</h3>
                        <p>Real-time driver tracking and status monitoring</p>
                    </div>
                    <div class="table-actions">
                        <button class="add-btn" onclick="showAddOperatorModal()">
                            <i class="fa-solid fa-plus"></i> Add Operator & Drivers
                        </button>
                        <button class="add-btn bulk-btn" onclick="showBulkUploadModal('drivers')">
                            <i class="fa-solid fa-file-excel"></i> Bulk Upload
                        </button>
                    </div>
                </div>
                <div class="search-container">
                    <input id="searchDrivers" type="text" placeholder="Search drivers, operators, or licenses..."
                        oninput="filterDrivers()">
                </div>
                <p id="no-drivers-message" style="display:none; color: red; margin-top: 10px;">No drivers found.</p>
                <table>
                    <thead>
                        <tr>
                            <th><i class="fa-solid fa-user"></i> Driver</th>
                            <th><i class="fa-solid fa-user-tie"></i> Operator</th>
                            <th><i class="fa-solid fa-address-book"></i> Contact</th>

                            <th><i class="fa-solid fa-phone-volume"></i> Emergency Contact</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="drivers-table"></tbody>
                </table>
            </div>



            <div id="live-map" class="tab">
                <div class="live-map-wrapper">
                    <header style="flex-shrink: 0;">
                        <div class="title-container">
                            <i class="fa-solid fa-map-location-dot"></i>
                            <h2>Live Map Tracking</h2>
                        </div>
                        <p>Real-time shuttle locations and routes</p>
                    </header>
                    <div class="table-header" style="flex-shrink: 0;">
                        <h3>Shuttle Map</h3>
                        <div class="table-actions">
                            <div class="map-search">
                                <input id="map-search-input" type="text" placeholder="Search location...">
                                <button class="action-btn" onclick="searchLocation()"><i
                                        class="fa-solid fa-search"></i></button>
                            </div>
                            <button class="action-btn" onclick="refreshMap()">Refresh</button>
                            <button class="action-btn" onclick="toggleTrafficLayer()">Toggle Traffic</button>
                        </div>
                    </div>
                    <div class="map-container">
                        <div id="map" style="flex: 1; position: relative;"></div>
                        <div class="active-shuttles"
                            style="width: 30%; max-height: calc(100vh - 160px); overflow-y: auto;">
                            <!-- Simulation Boxes -->
                            <div class="simulation-card hardware">
                                <h4><i class="fa-solid fa-microchip"></i> Hardware Simulation</h4>
                                <p>Simulate GPS data from hardware.</p>
                                <div class="input-group">
                                    <input type="number" id="sim-shuttle-id" placeholder="Shuttle ID">
                                    <div class="coord-row">
                                        <input type="number" id="sim-lat" placeholder="Latitude" step="any">
                                        <input type="number" id="sim-lng" placeholder="Longitude" step="any">
                                    </div>
                                </div>
                                <button onclick="simulateLocationUpdate()">Update Location</button>
                            </div>

                            <div class="simulation-card student">
                                <h4><i class="fa-solid fa-map-pin"></i> Student Pin Simulation</h4>
                                <p>Simulate Student setting their location.</p>
                                <div class="input-group">
                                    <input type="number" id="sim-stud-id" placeholder="Student ID">
                                    <div class="coord-row">
                                        <input type="number" id="sim-stud-lat" placeholder="Latitude" step="any">
                                        <input type="number" id="sim-stud-lng" placeholder="Longitude" step="any">
                                    </div>
                                </div>
                                <button onclick="simulateStudentLocation()">Set My Pin</button>
                            </div>

                            <div class="simulation-card driver">
                                <h4><i class="fa-solid fa-car"></i> Driver Ride Control</h4>
                                <p>Simulate Driver Starting/Ending Ride.</p>
                                <div class="input-group">
                                    <input type="number" id="sim-dest-shuttle-id" placeholder="Shuttle ID">
                                    <div class="coord-row">
                                        <input type="number" id="sim-dest-lat" placeholder="Latitude" step="any">
                                        <input type="number" id="sim-dest-lng" placeholder="Longitude" step="any">
                                    </div>
                                </div>
                                <div class="btn-row">
                                    <button class="start-btn" onclick="simulateStartRide()">Start Ride</button>
                                    <button class="end-btn" onclick="simulateDriverDestination()">End Ride (Set
                                        Dest)</button>
                                </div>
                            </div>
                            <div id="mouse-coordinates"
                                style="background: rgba(255, 255, 255, 0.8); padding: 5px; margin-bottom: 10px; border-radius: 4px; font-size: 12px; font-weight: bold;">
                                Mouse: Move over map
                            </div>

                            <h3>Active Shuttles</h3>
                            <p>Live Location Tracking</p>
                            <div class="shuttle-list" id="active-shuttles-list">
                                <div class="shuttle-item">
                                    <p><strong>Shuttle #1</strong> - On Time<br>Lat: 14.5995, Lng: 120.9842<br>Driver:
                                        John
                                        Doe<br>Route: A</p>
                                    <button class="action-btn track-btn" onclick="trackShuttle('Shuttle #1')">Track
                                        Shuttle</button>
                                    <button class="action-btn route-btn" onclick="showRoute('Shuttle #1')">Show
                                        Route</button>
                                </div>
                                <div class="shuttle-item">
                                    <p><strong>Shuttle #2</strong> - Delayed<br>Lat: 14.6760, Lng: 121.0437<br>Driver:
                                        Jane
                                        Smith<br>Route: B</p>
                                    <button class="action-btn track-btn" onclick="trackShuttle('Shuttle #2')">Track
                                        Shuttle</button>
                                    <button class="action-btn route-btn" onclick="showRoute('Shuttle #2')">Show
                                        Route</button>
                                </div>
                                <div class="shuttle-item">
                                    <p><strong>Shuttle #3</strong> - On Time<br>Lat: 14.5580, Lng: 121.0813<br>Driver:
                                        Alex
                                        Brown<br>Route: C</p>
                                    <button class="action-btn track-btn" onclick="trackShuttle('Shuttle #3')">Track
                                        Shuttle</button>
                                    <button class="action-btn route-btn" onclick="showRoute('Shuttle #3')">Show
                                        Route</button>
                                </div>
                                <div class="shuttle-item">
                                    <p><strong>Shuttle #4</strong> - Inactive<br>Lat: 14.5547, Lng: 121.0244<br>Driver:
                                        None<br>Route: None</p>
                                    <button class="action-btn track-btn" onclick="trackShuttle('Shuttle #4')">Track
                                        Shuttle</button>
                                    <button class="action-btn route-btn" onclick="showRoute('Shuttle #4')" disabled>No
                                        Route</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <script>
                        mapboxgl.accessToken = 'pk.eyJ1IjoiYWxmcmFuY2lzYnA0IiwiYSI6ImNtZnRqaDU2dzBsbGIyanM4cHFhbDY1MjMifQ.-ZQAt1NphjZJLxYUeMkZ7g';
                        const map = new mapboxgl.Map({
                            container: 'map',
                            style: 'mapbox://styles/mapbox/streets-v11',
                            center: [121.7740, 12.8797],
                            zoom: 5
                        });

                        window.dashboardMap = map;

                        map.on('load', () => {
                            // Initialize Mapbox Directions (Expose globally)
                            window.mapDirections = new MapboxDirections({
                                accessToken: mapboxgl.accessToken,
                                unit: 'metric',
                                profile: 'mapbox/driving-traffic',
                                controls: { inputs: true, instructions: true },
                                flyTo: false // Prevent auto-flying, we'll handle it
                            });
                            map.addControl(window.mapDirections, 'top-left');

                            // Initialize ETA sync between Mapbox Directions and Active Shuttles list
                            setTimeout(() => {
                                if (typeof setupMapDirectionsSync === 'function') {
                                    setupMapDirectionsSync();
                                }
                            }, 1000);

                            // Add Geolocation Control
                            map.addControl(new mapboxgl.GeolocateControl({
                                positionOptions: { enableHighAccuracy: true },
                                trackUserLocation: true,
                                showUserHeading: true
                            }), 'top-right');

                            // Add Scale Control
                            map.addControl(new mapboxgl.ScaleControl({ unit: 'metric' }), 'bottom-right');

                            // Add Map Style Selector
                            const styleSelector = document.createElement('div');
                            styleSelector.className = 'map-style-selector';
                            styleSelector.innerHTML = `
                        <select id="style-selector" onchange="changeMapStyle(this.value)">
                            <option value="mapbox://styles/mapbox/streets-v11">Streets</option>
                            <option value="mapbox://styles/mapbox/satellite-v9">Satellite</option>
                            <option value="mapbox://styles/mapbox/dark-v10">Dark</option>
                            <option value="mapbox://styles/mapbox/navigation-day-v1">Navigation Day</option>
                        </select>
                    `;
                            document.getElementById('map').prepend(styleSelector);

                            // Add Traffic Layer (initially hidden)
                            map.addSource('traffic', {
                                type: 'vector',
                                url: 'mapbox://mapbox.mapbox-traffic-v1'
                            });
                            map.addLayer({
                                id: 'traffic-layer',
                                type: 'line',
                                source: 'traffic',
                                'source-layer': 'traffic',
                                paint: {
                                    'line-color': [
                                        'case',
                                        ['==', ['get', 'congestion'], 'low'], '#00ff00',
                                        ['==', ['get', 'congestion'], 'moderate'], '#ffcc00',
                                        ['==', ['get', 'congestion'], 'heavy'], '#ff0000',
                                        ['==', ['get', 'congestion'], 'severe'], '#800000',
                                        '#000000'
                                    ],
                                    'line-width': 4,
                                    'line-opacity': 0.7
                                },
                                layout: { visibility: 'none' }
                            });

                            // Ensure map resizes correctly
                            map.resize();

                            // New: Mouse Coordinates
                            map.on('mousemove', (e) => {
                                document.getElementById('mouse-coordinates').innerText =
                                    `Lat: ${e.lngLat.lat.toFixed(6)}, Lng: ${e.lngLat.lng.toFixed(6)}`;
                            });

                            // New: Click to fill simulation box (Student or Shuttle)
                            map.on('click', (e) => {
                                // Default to shuttle sim inputs
                                document.getElementById('sim-lat').value = e.lngLat.lat.toFixed(6);
                                document.getElementById('sim-lng').value = e.lngLat.lng.toFixed(6);

                                // Also fill student sim inputs
                                if (document.getElementById('sim-stud-lat')) {
                                    document.getElementById('sim-stud-lat').value = e.lngLat.lat.toFixed(6);
                                    document.getElementById('sim-stud-lng').value = e.lngLat.lng.toFixed(6);
                                }

                                // Also fill driver destination inputs
                                if (document.getElementById('sim-dest-lat')) {
                                    document.getElementById('sim-dest-lat').value = e.lngLat.lat.toFixed(6);
                                    document.getElementById('sim-dest-lng').value = e.lngLat.lng.toFixed(6);
                                }
                            });
                        });

                        map.addControl(new mapboxgl.NavigationControl(), 'top-right');
                        map.addControl(new mapboxgl.FullscreenControl(), 'top-right');

                        // Hardcoded shuttles removed. Logic moved to script.js
                        const shuttles = [];
                        window.mapMarkers = []; // Global marker array for script.js to manage


                        // Sample routes for demonstration
                        const routes = {
                            'Shuttle #1': [[120.9842, 14.5995], [120.9900, 14.6000], [120.9950, 14.6050]],
                            'Shuttle #2': [[121.0437, 14.6760], [121.0500, 14.6800], [121.0550, 14.6850]],
                            'Shuttle #3': [[121.0813, 14.5580], [121.0850, 14.5600], [121.0900, 14.5650]],
                            'Shuttle #4': []
                        };





                        function toggleTrafficLayer() {
                            const visibility = map.getLayoutProperty('traffic-layer', 'visibility');
                            map.setLayoutProperty('traffic-layer', 'visibility', visibility === 'visible' ? 'none' : 'visible');
                            showToast(visibility === 'visible' ? 'Traffic layer hidden' : 'Traffic layer shown');
                        }

                        function changeMapStyle(style) {
                            map.setStyle(style);
                            showToast('Map style changed');
                            map.on('style.load', () => {
                                map.addSource('traffic', {
                                    type: 'vector',
                                    url: 'mapbox://mapbox.mapbox-traffic-v1'
                                });
                                map.addLayer({
                                    id: 'traffic-layer',
                                    type: 'line',
                                    source: 'traffic',
                                    'source-layer': 'traffic',
                                    paint: {
                                        'line-color': [
                                            'case',
                                            ['==', ['get', 'congestion'], 'low'], '#00ff00',
                                            ['==', ['get', 'congestion'], 'moderate'], '#ffcc00',
                                            ['==', ['get', 'congestion'], 'heavy'], '#ff0000',
                                            ['==', ['get', 'congestion'], 'severe'], '#800000',
                                            '#000000'
                                        ],
                                        'line-width': 4,
                                        'line-opacity': 0.7
                                    },
                                    layout: { visibility: 'none' }
                                });

                                // Markers and Routes will be handled by script.js


                                // Re-add Directions control after style change
                                window.mapDirections = new MapboxDirections({
                                    accessToken: mapboxgl.accessToken,
                                    unit: 'metric',
                                    profile: 'mapbox/driving-traffic',
                                    controls: { inputs: true, instructions: true },
                                    flyTo: false
                                });
                                map.addControl(window.mapDirections, 'top-left');
                            });
                        }



                        function showRoute(shuttleName) {
                            const route = routes[shuttleName];
                            if (!route || route.length < 2) {
                                showToast(`No route available for ${shuttleName}`);
                                return;
                            }

                            const coordinates = route;
                            map.getSource('route')?.setData({
                                type: 'Feature',
                                properties: {},
                                geometry: {
                                    type: 'LineString',
                                    coordinates: coordinates
                                }
                            }) || map.addSource('route', {
                                type: 'geojson',
                                data: {
                                    type: 'Feature',
                                    properties: {},
                                    geometry: {
                                        type: 'LineString',
                                        coordinates: coordinates
                                    }
                                }
                            });

                            map.getLayer('route') || map.addLayer({
                                id: 'route',
                                type: 'line',
                                source: 'route',
                                layout: {
                                    'line-join': 'round',
                                    'line-cap': 'round'
                                },
                                paint: {
                                    'line-color': '#003A6C',
                                    'line-width': 5,
                                    'line-opacity': 0.75
                                }
                            });

                            const bounds = coordinates.reduce((bounds, coord) => {
                                return bounds.extend(coord);
                            }, new mapboxgl.LngLatBounds(coordinates[0], coordinates[0]));
                            map.fitBounds(bounds, { padding: 50 });
                            showToast(`Showing route for ${shuttleName}`);
                        }

                        function searchLocation() {
                            const query = document.getElementById('map-search-input').value.trim();
                            if (!query) {
                                showToast('Please enter a location to search.');
                                return;
                            }

                            fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${encodeURIComponent(query)}.json?access_token=${mapboxgl.accessToken}&country=PH&limit=1`)
                                .then(response => response.json())
                                .then(data => {
                                    if (data.features && data.features.length > 0) {
                                        const [lng, lat] = data.features[0].center;
                                        map.flyTo({ center: [lng, lat], zoom: 12 });
                                        new mapboxgl.Marker()
                                            .setLngLat([lng, lat])
                                            .setPopup(new mapboxgl.Popup().setHTML(`<h3>${data.features[0].place_name}</h3>`))
                                            .addTo(map);
                                        showToast(`Found location: ${data.features[0].place_name}`);
                                    } else {
                                        showToast('Location not found. Please try a different search term.');
                                    }
                                })
                                .catch(error => {
                                    console.error('Error searching location:', error);
                                    showToast('Error searching location: ' + error.message);
                                });
                        }
                    </script>
                </div>
            </div>


            <div id="notifications" class="tab">
                <header>
                    <h2>Notifications</h2>
                    <button class="action-btn" onclick="markAllNotificationsRead()" style="margin-left: auto;">
                        <i class="fa-solid fa-check-double"></i> Mark All Read
                    </button>
                </header>
                <div class="active-shuttles">
                    <div id="notification-list">
                        <!-- Populated by JS -->
                        <p style="text-align: center; color: #666;">No new notifications.</p>
                    </div>
                </div>
            </div>

            <div id="profile" class="tab">
                <header>
                    <h2>Profile</h2>
                </header>
                <div class="profile-section">
                    <div class="profile-card" role="region" aria-labelledby="admin-info-title">
                        <h3 id="admin-info-title">Admin Information</h3>
                        <div class="info-row">
                            <div class="profile-picture-container">
                                <img id="admin-profile-picture" src="images/default-profile.png"
                                    alt="Admin Profile Picture"
                                    style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; margin-bottom: 1rem; border: 2px solid #f46354;">
                                <div class="profile-picture-upload">
                                    <input type="file" id="profile-picture-input" accept="image/*"
                                        style="display: none;">
                                    <button class="profile-button"
                                        onclick="document.getElementById('profile-picture-input').click()">Change
                                        Picture</button>
                                </div>
                                <p id="profile-picture-error" class="error-text" style="display: none;"></p>
                            </div>
                            <p><strong>Username:</strong> <span id="admin-username"></span></p>
                            <p><strong>Email:</strong> <span id="admin-email"></span></p>
                        </div>
                    </div>
                    <div class="profile-card" role="region" aria-labelledby="admin-reset-title">
                        <h3 id="admin-reset-title">Reset Your Password</h3>
                        <form id="admin-reset-password-form" class="profile-form" aria-labelledby="admin-reset-title">
                            <div class="form-group password-wrapper">
                                <label for="admin-current-password">Current Password</label>
                                <input type="password" id="admin-current-password" required>
                                <span class="toggle-password" onclick="togglePassword('admin-current-password', this)"
                                    aria-label="Toggle password visibility">
                                    <i class="fa-solid fa-eye-slash"></i>
                                </span>
                            </div>
                            <div class="form-group password-wrapper">
                                <label for="admin-new-password">New Password</label>
                                <input type="password" id="admin-new-password" required>
                                <span class="toggle-password" onclick="togglePassword('admin-new-password', this)"
                                    aria-label="Toggle password visibility">
                                    <i class="fa-solid fa-eye-slash"></i>
                                </span>
                            </div>
                            <div class="form-group password-wrapper">
                                <label for="admin-confirm-password">Confirm New Password</label>
                                <input type="password" id="admin-confirm-password" required>
                                <span class="toggle-password" onclick="togglePassword('admin-confirm-password', this)"
                                    aria-label="Toggle password visibility">
                                    <i class="fa-solid fa-eye-slash"></i>
                                </span>
                            </div>
                            <p id="admin-reset-error" class="error-text" style="display: none;"></p>
                            <button type="submit" class="profile-button">Reset Password</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Shuttle Modal -->
    <div id="addShuttleModal" class="modal" style="display: none;">
        <div class="modal-content add-form-modal">
            <div class="modal-header">
                <h3><i class="fa-solid fa-bus"></i> Add Shuttle</h3>
                <span class="close-modal" onclick="closeAddShuttleModal()">&times;</span>
            </div>
            <form id="addShuttleForm">
                <div class="form-group">
                    <label for="nameInput">Name (Optional)</label>
                    <input type="text" id="nameInput" placeholder="e.g., Shuttle A1">
                </div>
                <div class="form-group">
                    <label for="licensePlateInput">License Plate *</label>
                    <input type="text" id="licensePlateInput" required placeholder="e.g., ABC-1234">
                </div>
                <div class="form-group">
                    <label for="operatorSelect">Operator *</label>
                    <select id="operatorSelect" required
                        onchange="loadDriversForOperator('operatorSelect', 'driverSelect')">
                        <option value="">Select Operator</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="driverSelect">Driver *</label>
                    <select id="driverSelect" required>
                        <option value="">Select Driver</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="routeInput">Route *</label>
                    <input type="text" id="routeInput" required placeholder="e.g., Route A">
                </div>
                <div class="form-group">
                    <label for="maxCapacityInput">Max Capacity *</label>
                    <input type="number" id="maxCapacityInput" required min="1" value="50">
                </div>
                <p id="add-shuttle-error" class="error-text" style="display: none;"></p>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeAddShuttleModal()">Cancel</button>
                    <button type="submit" class="submit-btn">
                        <i class="fa-solid fa-save"></i> Add Shuttle
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Shuttle Modal -->
    <div id="editShuttleModal" class="modal" style="display: none;">
        <div class="modal-content add-form-modal">
            <div class="modal-header">
                <h3><i class="fa-solid fa-edit"></i> Edit Shuttle</h3>
                <span class="close-modal" onclick="closeEditShuttleModal()">&times;</span>
            </div>
            <form id="editShuttleForm">
                <input type="hidden" id="edit-shuttle-id">
                <div class="form-group">
                    <label for="edit-name-input">Name</label>
                    <input type="text" id="edit-name-input" placeholder="e.g., Shuttle A1">
                </div>
                <div class="form-group">
                    <label for="edit-license-plate-input">License Plate *</label>
                    <input type="text" id="edit-license-plate-input" required placeholder="e.g., ABC-1234">
                </div>
                <div class="form-group">
                    <label for="edit-status-select">Status *</label>
                    <select id="edit-status-select" required>
                        <option value="ACTIVE">Active</option>
                        <option value="INACTIVE">Inactive</option>
                        <option value="MAINTENANCE">Maintenance</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-operator-select">Operator *</label>
                    <select id="edit-operator-select" required
                        onchange="loadDriversForOperator('edit-operator-select', 'edit-driver-select')">
                        <option value="">Select Operator</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-driver-select">Driver *</label>
                    <select id="edit-driver-select" required>
                        <option value="">Select Driver</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="edit-route-input">Route *</label>
                    <input type="text" id="edit-route-input" required placeholder="e.g., Route A">
                </div>
                <div class="form-group">
                    <label for="edit-max-capacity-input">Max Capacity *</label>
                    <input type="number" id="edit-max-capacity-input" required min="1" value="50">
                </div>
                <p id="edit-shuttle-error" class="error-text" style="display: none;"></p>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeEditShuttleModal()">Cancel</button>
                    <button type="submit" class="submit-btn">
                        <i class="fa-solid fa-save"></i> Update Shuttle
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Parent & Students Modal -->
    <div id="addParentModal" class="modal" style="display: none;">
        <div class="modal-content add-form-modal">
            <div class="modal-header">
                <h3><i class="fa-solid fa-users"></i> Add Parent & Students</h3>
                <span class="close-modal" onclick="closeAddParentModal()">&times;</span>
            </div>
            <form id="addParentForm">
                <div class="form-section">
                    <h4><i class="fa-solid fa-user"></i> Parent Information</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="parent-username">Username *</label>
                            <input type="text" id="parent-username" required>
                        </div>
                        <div class="form-group">
                            <label for="parent-email">Email *</label>
                            <input type="email" id="parent-email" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group password-wrapper">
                            <label for="parent-password">Password *</label>
                            <input type="password" id="parent-password" required>
                            <span class="toggle-password" onclick="togglePassword('parent-password', this)">
                                <i class="fa-solid fa-eye-slash"></i>
                            </span>
                        </div>
                        <div class="form-group">
                            <label for="parent-fullname">Full Name *</label>
                            <input type="text" id="parent-fullname" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="parent-phone">Contact Phone *</label>
                            <input type="tel" id="parent-phone" placeholder="+63-912-345-6789" required>
                        </div>
                        <div class="form-group">
                            <label for="parent-address">Current Address *</label>
                            <input type="text" id="parent-address" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h4><i class="fa-solid fa-graduation-cap"></i> Students Information</h4>
                        <button type="button" class="add-student-btn" onclick="addStudentForm()">
                            <i class="fa-solid fa-plus"></i> Add Student
                        </button>
                    </div>
                    <div id="students-container">
                        <div class="student-form" data-student="1">
                            <div class="student-header">
                                <h5>Student 1</h5>
                                <button type="button" class="remove-student-btn" onclick="removeStudentForm(1)"
                                    style="display: none;">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="student-1-username">Username *</label>
                                    <input type="text" id="student-1-username" required>
                                </div>
                                <div class="form-group">
                                    <label for="student-1-email">Email *</label>
                                    <input type="email" id="student-1-email" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group password-wrapper">
                                    <label for="student-1-password">Password *</label>
                                    <input type="password" id="student-1-password" required>
                                    <span class="toggle-password" onclick="togglePassword('student-1-password', this)">
                                        <i class="fa-solid fa-eye-slash"></i>
                                    </span>
                                </div>
                                <div class="form-group">
                                    <label for="student-1-fullname">Full Name *</label>
                                    <input type="text" id="student-1-fullname" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="student-1-address">Current Address *</label>
                                    <input type="text" id="student-1-address" required>
                                </div>
                                <div class="form-group">
                                    <label for="student-1-grade">Grade *</label>
                                    <select id="student-1-grade" required>
                                        <option value="">Select Grade</option>
                                        <option value="Grade 7">Grade 7</option>
                                        <option value="Grade 8">Grade 8</option>
                                        <option value="Grade 9">Grade 9</option>
                                        <option value="Grade 10">Grade 10</option>
                                        <option value="Grade 11">Grade 11</option>
                                        <option value="Grade 12">Grade 12</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="student-1-section">Section *</label>
                                    <input type="text" id="student-1-section" placeholder="e.g., Section A" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <p id="add-parent-error" class="error-text" style="display: none;"></p>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeAddParentModal()">Cancel</button>
                    <button type="submit" class="submit-btn">
                        <i class="fa-solid fa-save"></i> Register Parent & Students
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Operator & Drivers Modal -->
    <div id="addOperatorModal" class="modal" style="display: none;">
        <div class="modal-content add-form-modal">
            <div class="modal-header">
                <h3><i class="fa-solid fa-bus"></i> Add Operator & Drivers</h3>
                <span class="close-modal" onclick="closeAddOperatorModal()">&times;</span>
            </div>
            <form id="addOperatorForm">
                <div class="form-section">
                    <h4><i class="fa-solid fa-user-tie"></i> Operator Information</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="operator-username">Username *</label>
                            <input type="text" id="operator-username" required>
                        </div>
                        <div class="form-group">
                            <label for="operator-email">Email *</label>
                            <input type="email" id="operator-email" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group password-wrapper">
                            <label for="operator-password">Password *</label>
                            <input type="password" id="operator-password" required>
                            <span class="toggle-password" onclick="togglePassword('operator-password', this)">
                                <i class="fa-solid fa-eye-slash"></i>
                            </span>
                        </div>
                        <div class="form-group">
                            <label for="operator-fullname">Full Name *</label>
                            <input type="text" id="operator-fullname" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="operator-phone">Contact Phone *</label>
                            <input type="tel" id="operator-phone" placeholder="+63-912-345-6789" required>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-header">
                        <h4><i class="fa-solid fa-id-card"></i> Drivers Information</h4>
                        <button type="button" class="add-driver-btn" onclick="addDriverForm()">
                            <i class="fa-solid fa-plus"></i> Add Driver
                        </button>
                    </div>
                    <div id="drivers-container">
                        <div class="driver-form" data-driver="1">
                            <div class="driver-header">
                                <h5>Driver 1</h5>
                                <button type="button" class="remove-driver-btn" onclick="removeDriverForm(1)"
                                    style="display: none;">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="driver-1-username">Username *</label>
                                    <input type="text" id="driver-1-username" required>
                                </div>
                                <div class="form-group">
                                    <label for="driver-1-email">Email *</label>
                                    <input type="email" id="driver-1-email" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group password-wrapper">
                                    <label for="driver-1-password">Password *</label>
                                    <input type="password" id="driver-1-password" required>
                                    <span class="toggle-password" onclick="togglePassword('driver-1-password', this)">
                                        <i class="fa-solid fa-eye-slash"></i>
                                    </span>
                                </div>

                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="driver-1-phone">Contact Phone *</label>
                                    <input type="tel" id="driver-1-phone" placeholder="+63-912-345-6789" required>
                                </div>
                                <div class="form-group">
                                    <label for="driver-1-emergency">Emergency Contact *</label>
                                    <input type="tel" id="driver-1-emergency" placeholder="+63-912-345-6789" required>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <p id="add-operator-error" class="error-text" style="display: none;"></p>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeAddOperatorModal()">Cancel</button>
                    <button type="submit" class="submit-btn">
                        <i class="fa-solid fa-save"></i> Register Operator & Drivers
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Bulk Upload Modal -->
    <div id="bulkUploadModal" class="modal" style="display: none;">
        <div class="modal-content bulk-upload-modal">
            <div class="modal-header">
                <h3 id="bulk-title"><i class="fa-solid fa-upload"></i> Bulk Upload</h3>
                <span class="close-modal" onclick="closeBulkUploadModal()">&times;</span>
            </div>
            <form id="bulkUploadForm">
                <div class="form-group">
                    <label for="bulk-file">Select XLSX File *</label>
                    <input type="file" id="bulk-file" accept=".xlsx" required>
                    <small>Upload an Excel file with user data.</small>
                </div>
                <p id="bulk-error" class="error-text" style="display: none;"></p>
                <div class="modal-actions">
                    <button type="button" class="action-btn" onclick="downloadBulkTemplate()"
                        style="margin-right: auto; background-color: #2196F3;">
                        <i class="fa-solid fa-download"></i> Download Template
                    </button>
                    <button type="button" class="cancel-btn" onclick="closeBulkUploadModal()">Cancel</button>
                    <button type="submit" class="submit-btn">
                        <i class="fa-solid fa-upload"></i> Upload File
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Student Modal -->
    <div id="editStudentModal" class="modal" style="display: none;">
        <div class="modal-content add-form-modal">
            <div class="modal-header">
                <h3><i class="fa-solid fa-user-edit"></i> Edit Student</h3>
                <span class="close-modal" onclick="closeEditStudentModal()">&times;</span>
            </div>
            <form id="editStudentForm">
                <input type="hidden" id="edit-student-id">
                <div class="form-section">
                    <h4><i class="fa-solid fa-graduation-cap"></i> Student Information</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-student-fullname">Full Name *</label>
                            <input type="text" id="edit-student-fullname" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-student-grade">Grade *</label>
                            <select id="edit-student-grade" required>
                                <option value="">Select Grade</option>
                                <option value="Grade 7">Grade 7</option>
                                <option value="Grade 8">Grade 8</option>
                                <option value="Grade 9">Grade 9</option>
                                <option value="Grade 10">Grade 10</option>
                                <option value="Grade 11">Grade 11</option>
                                <option value="Grade 12">Grade 12</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-student-section">Section *</label>
                            <input type="text" id="edit-student-section" placeholder="e.g., Section A" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-student-address">Current Address *</label>
                            <input type="text" id="edit-student-address" required>
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h4><i class="fa-solid fa-user"></i> Parent Information</h4>
                    <input type="hidden" id="edit-parent-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-parent-fullname">Full Name *</label>
                            <input type="text" id="edit-parent-fullname" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-parent-phone">Contact Phone *</label>
                            <input type="tel" id="edit-parent-phone" placeholder="+63-912-345-6789" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-parent-address">Current Address *</label>
                            <input type="text" id="edit-parent-address" required>
                        </div>
                    </div>
                </div>
                <p id="edit-student-error" class="error-text" style="display: none;"></p>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeEditStudentModal()">Cancel</button>
                    <button type="submit" class="submit-btn">
                        <i class="fa-solid fa-save"></i> Update Student & Parent
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Driver Modal -->
    <div id="editDriverModal" class="modal" style="display: none;">
        <div class="modal-content add-form-modal">
            <div class="modal-header">
                <h3><i class="fa-solid fa-user-edit"></i> Edit Driver</h3>
                <span class="close-modal" onclick="closeEditDriverModal()">&times;</span>
            </div>
            <form id="editDriverForm">
                <input type="hidden" id="edit-driver-id">
                <div class="form-section">
                    <h4><i class="fa-solid fa-id-card"></i> Driver Information</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-driver-contact">Contact Phone *</label>
                            <input type="tel" id="edit-driver-contact" placeholder="+63-912-345-6789" required>
                        </div>

                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-driver-emergency">Emergency Contact *</label>
                            <input type="tel" id="edit-driver-emergency" placeholder="+63-912-345-6789" required>
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h4><i class="fa-solid fa-user-tie"></i> Operator Information</h4>
                    <input type="hidden" id="edit-operator-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-operator-fullname">Full Name *</label>
                            <input type="text" id="edit-operator-fullname" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-operator-phone">Contact Phone *</label>
                            <input type="tel" id="edit-operator-phone" placeholder="+63-912-345-6789" required>
                        </div>
                    </div>
                </div>
                <p id="edit-driver-error" class="error-text" style="display: none;"></p>
                <div class="modal-actions">
                    <button type="button" class="cancel-btn" onclick="closeEditDriverModal()">Cancel</button>
                    <button type="submit" class="submit-btn">
                        <i class="fa-solid fa-save"></i> Update Driver & Operator
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="modal-confirm" style="display: none;">
        <div class="modal-confirm-content">
            <h3>Confirm Delete</h3>
            <p id="deleteConfirmMessage">Are you sure you want to delete this item? This action cannot be
                undone.</p>
            <input type="hidden" id="deleteItemId">
            <input type="hidden" id="deleteItemType">
            <button class="confirm-action" onclick="confirmDelete()">Delete</button>
            <button class="cancel-action" onclick="cancelDelete()">Cancel</button>
        </div>
    </div>

    <!-- Shuttle Students Modal -->
    <div id="shuttleStudentsModal" class="modal">
        <div class="modal-content" style="width: 95%; max-width: 700px;">
            <div class="modal-header">
                <h3>Assigned Students <span id="modal-shuttle-id-display"
                        style="font-weight:normal; font-size: 0.8em; color: gray;"></span></h3>
                <span class="close-modal" onclick="closeShuttleStudentsModal()">&times;</span>
            </div>
            <div class="modal-body">
                <input type="text" id="searchShuttleStudents" placeholder="Search students..."
                    style="width: 100%; padding: 8px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 4px;"
                    oninput="filterShuttleStudents()">
                <div style="max-height: 500px; overflow-y: auto;">
                    <table style="width: 100%; border-collapse: collapse;">
                        <thead>
                            <tr style="background-color: #f2f2f2; position: sticky; top: 0;">
                                <th
                                    style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd; color: #333;">
                                    ID
                                </th>
                                <th
                                    style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd; color: #333;">
                                    Name
                                </th>
                                <th
                                    style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd; color: #333;">
                                    Location</th>
                            </tr>
                        </thead>
                        <tbody id="shuttle-students-tbody">
                            <!-- Populated dynamically -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="logoutConfirmModal" class="modal-confirm" style="display: none;">
        <div class="modal-confirm-content">
            <h3>Confirm Logout</h3>
            <p>Are you sure you want to log out?</p>
            <button class="confirm-action" onclick="confirmLogout()">Logout</button>
            <button class="cancel-action" onclick="cancelLogout()">Cancel</button>
        </div>
    </div>
    </div>



    <!-- Assign Shuttle Modal -->
    <div id="assignShuttleModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAssignShuttleModal()">&times;</span>
            <h2>Assign Shuttle</h2>
            <form id="assignShuttleForm">
                <input type="hidden" id="assign-student-id">
                <div class="form-group">
                    <label>Select Shuttle</label>
                    <select id="assign-shuttle-select" required></select>
                </div>
                <button type="submit" class="submit-btn">Save Assignment</button>
            </form>
        </div>
    </div>

    <!-- Register Device Modal -->
    <div id="registerDeviceModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeRegisterDeviceModal()">&times;</span>
            <h2><i class="fa-solid fa-id-card"></i> Register Device</h2>
            <form id="registerDeviceForm">
                <input type="hidden" id="register-device-student-id">
                <div class="form-group">
                    <label>Student Name</label>
                    <input type="text" id="register-device-student-name" readonly style="background-color: #f0f0f0;">
                </div>
                <div class="form-group">
                    <label>RFID Tag</label>
                    <input type="text" id="rfidInput" placeholder="Scan RFID Card">
                </div>
                <div class="form-group">
                    <label>Fingerprint Scans (Up to 3)</label>
                    <div id="fp-progress-container"
                        style="background-color: #e0e0e0; border-radius: 5px; height: 10px; margin-bottom: 5px; overflow: hidden;">
                        <div id="fp-progress-bar"
                            style="width: 0%; height: 100%; background-color: #4CAF50; transition: width 0.3s;"></div>
                    </div>
                    <p id="fp-progress-text" style="font-size: 0.8em; color: #666; margin-bottom: 10px;">0/3 Scanned</p>
                    <div style="display: flex; gap: 10px; flex-direction: column;">
                        <input type="text" id="fingerprintInput1" placeholder="Scan Finger 1">
                        <input type="text" id="fingerprintInput2" placeholder="Scan Finger 2">
                        <input type="text" id="fingerprintInput3" placeholder="Scan Finger 3">
                    </div>
                </div>
                <p id="register-device-error" class="error-text" style="display: none;"></p>
                <button type="submit" class="submit-btn" style="background: linear-gradient(135deg, #4CAF50, #388E3C);">
                    <i class="fa-solid fa-save"></i> Register Device
                </button>
            </form>
        </div>
    </div>
    <!-- Registration Details Modal -->
    <div id="registrationDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeRegistrationDetailsModal()">&times;</span>
            <h2><i class="fa-solid fa-list-check"></i> Registration Details</h2>
            <div id="registration-details-content" style="padding: 10px;">
                <div class="detail-row"
                    style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                    <strong style="color: #003A6C;">Student:</strong> <span id="reg-detail-name"></span>
                </div>
                <div class="detail-row"
                    style="margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                    <strong style="color: #003A6C;">RFID Tag:</strong> <span id="reg-detail-rfid"
                        style="font-family: monospace; background: #f5f5f5; padding: 2px 5px; border-radius: 3px;"></span>
                </div>
                <div class="detail-row">
                    <strong style="color: #003A6C;">Fingerprint Status:</strong>
                    <ul id="reg-detail-fingerprints" style="list-style: none; padding-left: 10px; margin-top: 5px;">
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script src="script.js?v=3"></script>
    <script>
        function togglePassword(id, iconSpan) {
            const input = document.getElementById(id);
            const icon = iconSpan.querySelector('i');
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            }
        }


    </script>
</body>

</html>